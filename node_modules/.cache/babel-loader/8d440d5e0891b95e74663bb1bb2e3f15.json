{"ast":null,"code":"var _jsxFileName = \"/home/sai/projects/django-apps/providertool/frontend/javascript/skeleton/src/contexts/JWTContext.js\",\n    _s = $RefreshSig$();\n\nimport PropTypes from 'prop-types';\nimport React, { createContext, useEffect, useReducer } from 'react'; // third-party\n\nimport jwtDecode from 'jwt-decode'; // reducer - state management\n\nimport { ACCOUNT_INITIALIZE, LOGIN, LOGOUT } from 'store/actionTypes';\nimport accountReducer from 'store/reducers/accountReducer'; // project imports\n\nimport axios from 'utils/axios';\nimport Loader from 'ui-component/Loader'; // constant\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst initialState = {\n  isLoggedIn: false,\n  isInitialized: false,\n  user: null\n};\n\nconst verifyToken = serviceToken => {\n  if (!serviceToken) {\n    return false;\n  }\n\n  const decoded = jwtDecode(serviceToken);\n  return decoded.exp > Date.now() / 1000;\n};\n\nconst setSession = serviceToken => {\n  if (serviceToken) {\n    localStorage.setItem('serviceToken', serviceToken);\n    axios.defaults.headers.common.Authorization = `Bearer ${serviceToken}`;\n  } else {\n    localStorage.removeItem('serviceToken');\n    delete axios.defaults.headers.common.Authorization;\n  }\n}; // ===========================|| JWT CONTEXT & PROVIDER ||=========================== //\n\n\nconst JWTContext = /*#__PURE__*/createContext({ ...initialState,\n  login: () => Promise.resolve(),\n  logout: () => {}\n});\nexport const JWTProvider = ({\n  children\n}) => {\n  _s();\n\n  const [state, dispatch] = useReducer(accountReducer, initialState);\n\n  const login = async (email, password) => {\n    console.log(email);\n    console.log(password); //\n    // const response = await axios.post('/api/account/login', { email, password });\n    //\n\n    console.log(\"Line 57\");\n    const {\n      serviceToken,\n      user\n    } = response.data;\n    setSession(serviceToken);\n    dispatch({\n      type: LOGIN,\n      payload: {\n        user\n      }\n    });\n  };\n\n  const logout = () => {\n    setSession(null);\n    dispatch({\n      type: LOGOUT\n    });\n  };\n\n  useEffect(() => {\n    const init = async () => {\n      try {\n        const serviceToken = window.localStorage.getItem('serviceToken');\n\n        if (serviceToken && verifyToken(serviceToken)) {\n          setSession(serviceToken);\n          const response = await axios.get('/api/account/me');\n          const {\n            user\n          } = response.data;\n          dispatch({\n            type: ACCOUNT_INITIALIZE,\n            payload: {\n              isLoggedIn: true,\n              user\n            }\n          });\n        } else {\n          dispatch({\n            type: ACCOUNT_INITIALIZE,\n            payload: {\n              isLoggedIn: false,\n              user: null\n            }\n          });\n        }\n      } catch (err) {\n        console.error(err);\n        dispatch({\n          type: ACCOUNT_INITIALIZE,\n          payload: {\n            isLoggedIn: false,\n            user: null\n          }\n        });\n      }\n    };\n\n    init();\n  }, []);\n\n  if (!state.isInitialized) {\n    return /*#__PURE__*/_jsxDEV(Loader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 16\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(JWTContext.Provider, {\n    value: { ...state,\n      login,\n      logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 117,\n    columnNumber: 12\n  }, this);\n};\n\n_s(JWTProvider, \"bgCdjuTOmPdSBRwTap80EFd9Y3U=\");\n\n_c = JWTProvider;\nJWTProvider.propTypes = {\n  children: PropTypes.node.isRequired\n};\nexport default JWTContext;\n\nvar _c;\n\n$RefreshReg$(_c, \"JWTProvider\");","map":{"version":3,"sources":["/home/sai/projects/django-apps/providertool/frontend/javascript/skeleton/src/contexts/JWTContext.js"],"names":["PropTypes","React","createContext","useEffect","useReducer","jwtDecode","ACCOUNT_INITIALIZE","LOGIN","LOGOUT","accountReducer","axios","Loader","initialState","isLoggedIn","isInitialized","user","verifyToken","serviceToken","decoded","exp","Date","now","setSession","localStorage","setItem","defaults","headers","common","Authorization","removeItem","JWTContext","login","Promise","resolve","logout","JWTProvider","children","state","dispatch","email","password","console","log","response","data","type","payload","init","window","getItem","get","err","error","propTypes","node","isRequired"],"mappings":"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","sourcesContent":["import PropTypes from 'prop-types';\r\nimport React, { createContext, useEffect, useReducer } from 'react';\r\n\r\n// third-party\r\nimport jwtDecode from 'jwt-decode';\r\n\r\n// reducer - state management\r\nimport { ACCOUNT_INITIALIZE, LOGIN, LOGOUT } from 'store/actionTypes';\r\nimport accountReducer from 'store/reducers/accountReducer';\r\n\r\n// project imports\r\nimport axios from 'utils/axios';\r\nimport Loader from 'ui-component/Loader';\r\n\r\n// constant\r\nconst initialState = {\r\n    isLoggedIn: false,\r\n    isInitialized: false,\r\n    user: null\r\n};\r\n\r\nconst verifyToken = (serviceToken) => {\r\n    if (!serviceToken) {\r\n        return false;\r\n    }\r\n    const decoded = jwtDecode(serviceToken);\r\n    return decoded.exp > Date.now() / 1000;\r\n};\r\n\r\nconst setSession = (serviceToken) => {\r\n    if (serviceToken) {\r\n        localStorage.setItem('serviceToken', serviceToken);\r\n        axios.defaults.headers.common.Authorization = `Bearer ${serviceToken}`;\r\n    } else {\r\n        localStorage.removeItem('serviceToken');\r\n        delete axios.defaults.headers.common.Authorization;\r\n    }\r\n};\r\n\r\n// ===========================|| JWT CONTEXT & PROVIDER ||=========================== //\r\n\r\nconst JWTContext = createContext({\r\n    ...initialState,\r\n    login: () => Promise.resolve(),\r\n    logout: () => {}\r\n});\r\n\r\nexport const JWTProvider = ({ children }) => {\r\n    const [state, dispatch] = useReducer(accountReducer, initialState);\r\n\r\n    const login = async (email, password) => {\r\n        console.log(email);\r\n        console.log(password);\r\n        //\r\n        // const response = await axios.post('/api/account/login', { email, password });\r\n        //\r\n        console.log(\"Line 57\");\r\n\r\n        const { serviceToken, user } = response.data;\r\n        setSession(serviceToken);\r\n        dispatch({\r\n            type: LOGIN,\r\n            payload: {\r\n                user\r\n            }\r\n        });\r\n    };\r\n\r\n    const logout = () => {\r\n        setSession(null);\r\n        dispatch({ type: LOGOUT });\r\n    };\r\n\r\n    useEffect(() => {\r\n        const init = async () => {\r\n            try {\r\n                const serviceToken = window.localStorage.getItem('serviceToken');\r\n                if (serviceToken && verifyToken(serviceToken)) {\r\n                    setSession(serviceToken);\r\n                    const response = await axios.get('/api/account/me');\r\n                    const { user } = response.data;\r\n                    dispatch({\r\n                        type: ACCOUNT_INITIALIZE,\r\n                        payload: {\r\n                            isLoggedIn: true,\r\n                            user\r\n                        }\r\n                    });\r\n                } else {\r\n                    dispatch({\r\n                        type: ACCOUNT_INITIALIZE,\r\n                        payload: {\r\n                            isLoggedIn: false,\r\n                            user: null\r\n                        }\r\n                    });\r\n                }\r\n            } catch (err) {\r\n                console.error(err);\r\n                dispatch({\r\n                    type: ACCOUNT_INITIALIZE,\r\n                    payload: {\r\n                        isLoggedIn: false,\r\n                        user: null\r\n                    }\r\n                });\r\n            }\r\n        };\r\n\r\n        init();\r\n    }, []);\r\n\r\n    if (!state.isInitialized) {\r\n        return <Loader />;\r\n    }\r\n\r\n    return <JWTContext.Provider value={{ ...state, login, logout }}>{children}</JWTContext.Provider>;\r\n};\r\n\r\nJWTProvider.propTypes = {\r\n    children: PropTypes.node.isRequired\r\n};\r\n\r\nexport default JWTContext;\r\n"]},"metadata":{},"sourceType":"module"}